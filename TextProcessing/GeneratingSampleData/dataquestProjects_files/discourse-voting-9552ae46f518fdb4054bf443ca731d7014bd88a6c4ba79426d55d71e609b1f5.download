define("discourse/plugins/discourse-voting/discourse/feature-voting-route-map",["exports"],(function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={resource:"user",path:"users/:username",map:function(){this.route("userActivity",{path:"activity",resetNamespace:!0},(function(){this.route("votes")}))}}})),define("discourse/plugins/discourse-voting/discourse/initializers/discourse-voting",["exports","I18n","discourse/lib/plugin-api","discourse/models/nav-item"],(function(t,e,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={name:"discourse-voting",initialize:function(){(0,o.withPluginApi)("0.8.32",(function(t){t.container.lookup("site-settings:main").voting_enabled&&(t.container.lookup("controller:full-page-search").sortOrders.pushObject({name:e.default.t("search.most_votes"),id:5,term:"order:votes"}),t.addNavigationBarItem({name:"votes",before:"top",customFilter:function(t){return t&&t.can_vote},customHref:function(t,e){var o=s.default.pathFor("latest",e);return"".concat(o,"?order=votes")},forceActive:function(t,e,o){var s=o.currentRoute.queryParams;return s&&1===Object.keys(s).length&&"votes"===s.order}}),t.addNavigationBarItem({name:"my_votes",before:"top",customFilter:function(e){return e&&e.can_vote&&t.getCurrentUser()},customHref:function(t,e){var o=s.default.pathFor("latest",e);return"".concat(o,"?state=my_votes")},forceActive:function(t,e,o){var s=o.currentRoute.queryParams;return s&&1===Object.keys(s).length&&"my_votes"===s.state}}))})),(0,o.withPluginApi)("0.11.7",(function(t){t.container.lookup("site-settings:main").voting_enabled&&t.addSearchSuggestion("order:votes")}))}};t.default=i})),define("discourse/plugins/discourse-voting/discourse/pre-initializers/extend-category-for-voting",["exports","I18n","discourse/lib/plugin-api"],(function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={name:"extend-category-for-voting",before:"inject-discourse-objects",initialize:function(){(0,o.withPluginApi)("0.8.4",(function(t){return function(t){t.addPostClassesCallback((function(t){if(1===t.post_number&&t.can_vote)return["voting-post"]})),t.includePostAttributes("can_vote"),t.addTagsHtmlCallback((function(t){if(t.can_vote){var o=[],s="";t.user_voted&&(s=" title='".concat(e.default.t("voting.voted"),"'"));var i=t.user_voted?" voted":"";return o.push("<a href='".concat(t.url,"' class='list-vote-count vote-count-").concat(t.vote_count," discourse-tag simple").concat(i,"'").concat(s,">")),o.push(e.default.t("voting.votes",{count:t.vote_count})),o.push("</a>"),o.length>0?o.join(""):void 0}}),{priority:-100})}(t)})),(0,o.withPluginApi)("0.8.30",(function(t){return t.addCategorySortCriteria("votes")}))}};t.default=s})),define("discourse/plugins/discourse-voting/discourse/routes/user-activity-votes",["exports","discourse/routes/user-topic-list","discourse/models/user-action"],(function(t,e,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=e.default.extend({userActionType:o.default.TYPES.topics,model:function(){return this.store.findFiltered("topicList",{filter:"topics/voted-by/"+this.modelFor("user").get("username_lower")})}});t.default=s})),Ember.TEMPLATES["javascripts/connectors/category-custom-settings/feature-voting-settings"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"h3",true],[8],[1,[28,"i18n",["voting.title"],null],false],[9],[0,"\\n"],[7,"section",true],[10,"class","field"],[8],[0,"\\n  "],[7,"div",true],[10,"class","enable-topic-voting"],[8],[0,"\\n    "],[7,"label",true],[10,"class","checkbox-label"],[8],[0,"\\n      "],[1,[28,"input",null,[["type","checked"],["checkbox",[24,["category","custom_fields","enable_topic_voting"]]]]],false],[0,"\\n      "],[1,[28,"i18n",["voting.allow_topic_voting"],null],false],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/category-custom-settings/feature-voting-settings"}}),Ember.TEMPLATES["javascripts/connectors/topic-above-post-stream/topic-title-voting"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["model","can_vote"]]],null,{"statements":[[4,"if",[[24,["model","postStream","loaded"]]],null,{"statements":[[4,"if",[[24,["model","postStream","firstPostPresent"]]],null,{"statements":[[0,"      "],[7,"div",true],[10,"class","voting title-voting"],[8],[0,"\\n        "],[1,[28,"mount-widget",null,[["widget","args","showLogin"],["vote-box",[24,["model"]],[28,"route-action",["showLogin"],null]]]],false],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[]},null]],"parameters":[]},null]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/topic-above-post-stream/topic-title-voting"}}),Ember.TEMPLATES["javascripts/connectors/user-activity-bottom/user-voted-topics"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["siteSettings","voting_show_votes_on_profile"]]],null,{"statements":[[0,"  "],[7,"li",true],[8],[0,"\\n"],[4,"link-to",null,[["route"],["userActivity.votes"]],{"statements":[[0,"      "],[1,[28,"d-icon",["heart"],null],false],[0," "],[1,[28,"i18n",["voting.vote_title_plural"],null],false],[0,"\\n"]],"parameters":[]},null],[0,"  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/user-activity-bottom/user-voted-topics"}}),define("discourse/plugins/discourse-voting/discourse/widgets/remove-vote",["exports","I18n","discourse/widgets/widget","discourse-common/lib/icon-library"],(function(t,e,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=(0,o.createWidget)("remove-vote",{tagName:"div.remove-vote",buildClasses:function(){return"vote-option"},html:function(){return[(0,s.iconNode)("times"),e.default.t("voting.remove_vote")]},click:function(){this.sendWidgetAction("removeVote")}});t.default=i})),define("discourse/plugins/discourse-voting/discourse/widgets/vote-box",["exports","I18n","discourse/widgets/widget","discourse/lib/ajax","discourse/widgets/raw-html","discourse/lib/ajax-error"],(function(t,e,o,s,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(0,o.createWidget)("vote-box",{tagName:"div.voting-wrapper",buildKey:function(){return"vote-box"},buildClasses:function(){if(this.siteSettings.voting_show_who_voted)return"show-pointer"},defaultState:function(){return{allowClick:!0,initialVote:!1}},html:function(t,o){var s=[this.attach("vote-count",t),this.attach("vote-button",t),this.attach("vote-options",t)];if(o.votesAlert>0){var n="<div class='voting-popup-menu vote-options popup-menu'>"+e.default.t("voting.votes_left",{count:o.votesAlert,path:this.currentUser.get("path")+"/activity/votes"})+"</div>";s.push(new i.default({html:n}))}return s},hideVotesAlert:function(){this.state.votesAlert&&(this.state.votesAlert=null,this.scheduleRerender())},click:function(){this.hideVotesAlert()},clickOutside:function(){this.hideVotesAlert()},addVote:function(){var t=this,e=this.attrs,o=this.state;return(0,s.ajax)("/voting/vote",{type:"POST",data:{topic_id:e.id}}).then((function(s){e.set("vote_count",s.vote_count),e.set("user_voted",!0),t.currentUser.setProperties({votes_exceeded:!s.can_vote,votes_left:s.votes_left}),s.alert&&(o.votesAlert=s.votes_left),e.set("who_voted",s.who_voted),o.allowClick=!0,t.scheduleRerender()})).catch(n.popupAjaxError)},removeVote:function(){var t=this,e=this.attrs,o=this.state;return(0,s.ajax)("/voting/unvote",{type:"POST",data:{topic_id:e.id}}).then((function(s){e.set("vote_count",s.vote_count),e.set("user_voted",!1),t.currentUser.setProperties({votes_exceeded:!s.can_vote,votes_left:s.votes_left}),e.set("who_voted",s.who_voted),o.allowClick=!0,t.scheduleRerender()})).catch(n.popupAjaxError)}});t.default=r})),define("discourse/plugins/discourse-voting/discourse/widgets/vote-button",["exports","I18n","discourse/widgets/widget","virtual-dom"],(function(t,e,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=(0,o.createWidget)("vote-button",{tagName:"div",buildClasses:function(t){var e="";return e=t.closed?"voting-closed":t.user_voted?this.currentUser&&this.currentUser.votes_exceeded?"vote-limited nonvote":"vote":"nonvote",this.siteSettings.voting_show_who_voted&&(e+=" show-pointer"),e},buildButtonTitle:function(t){return this.currentUser?t.closed?e.default.t("voting.voting_closed_title"):t.user_voted?e.default.t("voting.voted_title"):this.currentUser.votes_exceeded?e.default.t("voting.voting_limit"):e.default.t("voting.vote_title"):t.vote_count?e.default.t("voting.anonymous_button",{count:t.vote_count}):e.default.t("voting.anonymous_button",{count:1})},html:function(t){return(0,s.h)("button",{attributes:{title:this.currentUser?e.default.t("voting.votes_left_button_title",{count:this.currentUser.votes_left}):""},className:"btn btn-primary vote-button"},this.buildButtonTitle(t))},click:function(){if(!this.currentUser)return this.sendWidgetAction("showLogin"),void $.cookie("destination_url",window.location.href);this.attrs.closed||!this.parentWidget.state.allowClick||this.attrs.user_voted||this.currentUser.votes_exceeded||(this.parentWidget.state.allowClick=!1,this.parentWidget.state.initialVote=!0,this.sendWidgetAction("addVote")),(this.attrs.user_voted||this.currentUser.votes_exceeded)&&$(".vote-options").toggleClass("hidden")},clickOutside:function(){$(".vote-options").addClass("hidden"),this.parentWidget.state.initialVote=!1}});t.default=i})),define("discourse/plugins/discourse-voting/discourse/widgets/vote-count",["exports","discourse/widgets/widget","discourse-common/lib/get-url","virtual-dom","discourse/lib/ajax"],(function(t,e,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(0,e.createWidget)("vote-count",{tagName:"div.vote-count-wrapper",buildKey:function(){return"vote-count"},buildClasses:function(){if(0===this.attrs.vote_count)return"no-votes"},defaultState:function(){return{whoVotedUsers:null}},html:function(t){var e=(0,s.h)("div.vote-count",t.vote_count.toString()),o=null;this.siteSettings.voting_show_who_voted&&this.state.whoVotedUsers&&this.state.whoVotedUsers.length>0&&(o=this.attach("small-user-list",{users:this.state.whoVotedUsers,addSelf:t.liked,listClassName:"regular-votes"}));var i=[e];return o&&i.push((0,s.h)("div.who-voted.popup-menu.voting-popup-menu",[o])),i},click:function(){if(!this.currentUser)return this.sendWidgetAction("showLogin"),void $.cookie("destination_url",window.location.href);if(this.siteSettings.voting_show_who_voted&&this.attrs.vote_count>0){if(null===this.state.whoVotedUsers)return this.getWhoVoted();$(".who-voted").toggle()}},clickOutside:function(){$(".who-voted").hide()},getWhoVoted:function(){var t=this;return(0,i.ajax)("/voting/who",{type:"GET",data:{topic_id:this.attrs.id}}).then((function(e){t.state.whoVotedUsers=e.map(r)}))}});function r(t){return{template:t.avatar_template,username:t.username,post_url:t.post_url,url:(0,o.default)("/u/")+t.username.toLowerCase()}}t.default=n})),define("discourse/plugins/discourse-voting/discourse/widgets/vote-options",["exports","I18n","discourse/widgets/widget","virtual-dom"],(function(t,e,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=(0,o.createWidget)("vote-options",{tagName:"div.vote-options",buildClasses:function(){return"voting-popup-menu popup-menu hidden"},html:function(t){var o=[];return t.user_voted?o.push(this.attach("remove-vote",t)):this.currentUser&&this.currentUser.votes_exceeded&&!t.user_voted&&o.push([(0,s.h)("div",e.default.t("voting.reached_limit")),(0,s.h)("p",(0,s.h)("a",{href:this.currentUser.get("path")+"/activity/votes"},e.default.t("voting.list_votes")))]),o}});t.default=i}));
//# sourceMappingURL=discourse-voting-9552ae46f518fdb4054bf443ca731d7014bd88a6c4ba79426d55d71e609b1f55.js.map