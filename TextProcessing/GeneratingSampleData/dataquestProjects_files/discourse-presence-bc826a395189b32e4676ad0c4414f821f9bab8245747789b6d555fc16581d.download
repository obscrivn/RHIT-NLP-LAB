define("discourse/plugins/discourse-presence/discourse/components/composer-presence-display",["exports","discourse-common/utils/decorators","@ember/object/computed","@ember/component","@ember/service"],(function(e,n,t,r,s){"use strict";var i,l,a,o,c,u,p,h,d,f;function m(e,n,t,r,s){var i={};return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce((function(t,r){return r(e,n,t)||t}),i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,n,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var y=r.default.extend((i=(0,n.default)("model.replyingToTopic","model.editingPost","model.whisper","model.composerOpened"),l=(0,n.default)("model.topic.id","isReply","isWhisper"),a=(0,n.default)("model.topic.id","isReply","isWhisper"),o=(0,n.default)("isEdit","model.post.id"),c=(0,n.observes)("replyChannelName","whisperChannelName","editChannelName"),u=(0,n.default)("isReply","replyingUsers.[]","editingUsers.[]"),p=(0,n.on)("didInsertElement"),h=(0,n.observes)("model.reply","state","model.post.id","model.topic.id"),d=(0,n.on)("willDestroyElement"),m(f={tagName:"",presence:(0,s.inject)(),composerPresenceManager:(0,s.inject)(),state:function(e,n,t,r){if(r)return n?"edit":t?"whisper":e?"reply":void 0},isReply:(0,t.equal)("state","reply"),isEdit:(0,t.equal)("state","edit"),isWhisper:(0,t.equal)("state","whisper"),replyChannelName:function(e,n,t){if(e&&(n||t))return"/discourse-presence/reply/".concat(e)},whisperChannelName:function(e,n,t){if(e&&this.currentUser.staff&&(n||t))return"/discourse-presence/whisper/".concat(e)},editChannelName:function(e,n){if(e)return"/discourse-presence/edit/".concat(n)},_setupChannel:function(e,n){var t,r;(null===(t=this[e])||void 0===t?void 0:t.name)!==n&&(null===(r=this[e])||void 0===r||r.unsubscribe(),n?(this.set(e,this.presence.getChannel(n)),this[e].subscribe()):this[e]&&this.set(e,null))},_setupChannels:function(){this._setupChannel("replyChannel",this.replyChannelName),this._setupChannel("whisperChannel",this.whisperChannelName),this._setupChannel("editChannel",this.editChannelName)},_cleanupChannels:function(){this._setupChannel("replyChannel",null),this._setupChannel("whisperChannel",null),this._setupChannel("editChannel",null)},replyingUsers:(0,t.union)("replyChannel.users","whisperChannel.users"),editingUsers:(0,t.readOnly)("editChannel.users"),presenceUsers:function(e,n,t){var r,s=this,i=e?n:t;return null==i||null===(r=i.filter((function(e){return e.id!==s.currentUser.id})))||void 0===r?void 0:r.slice(0,this.siteSettings.presence_max_users_shown)},shouldDisplay:(0,t.gt)("presenceUsers.length",0),subscribe:function(){this._setupChannels()},_contentChanged:function(){var e,n;if(""!==this.model.reply){var t="edit"===this.state?null===(e=this.model)||void 0===e?void 0:e.post:null===(n=this.model)||void 0===n?void 0:n.topic;this.composerPresenceManager.notifyState(this.state,null==t?void 0:t.id)}},closeComposer:function(){this._cleanupChannels(),this.composerPresenceManager.leave()}},"state",[i],Object.getOwnPropertyDescriptor(f,"state"),f),m(f,"replyChannelName",[l],Object.getOwnPropertyDescriptor(f,"replyChannelName"),f),m(f,"whisperChannelName",[a],Object.getOwnPropertyDescriptor(f,"whisperChannelName"),f),m(f,"editChannelName",[o],Object.getOwnPropertyDescriptor(f,"editChannelName"),f),m(f,"_setupChannels",[c],Object.getOwnPropertyDescriptor(f,"_setupChannels"),f),m(f,"presenceUsers",[u],Object.getOwnPropertyDescriptor(f,"presenceUsers"),f),m(f,"subscribe",[p],Object.getOwnPropertyDescriptor(f,"subscribe"),f),m(f,"_contentChanged",[h],Object.getOwnPropertyDescriptor(f,"_contentChanged"),f),m(f,"closeComposer",[d],Object.getOwnPropertyDescriptor(f,"closeComposer"),f),f));e.default=y})),define("discourse/plugins/discourse-presence/discourse/components/topic-presence-display",["exports","discourse-common/utils/decorators","@ember/component","@ember/object/computed","@ember/service"],(function(e,n,t,r,s){"use strict";var i,l,a,o,c,u;function p(e,n,t,r,s){var i={};return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce((function(t,r){return r(e,n,t)||t}),i),s&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(s):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,n,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var h=t.default.extend((i=(0,n.default)("replyChannel.users.[]"),l=(0,n.default)("whisperChannel.users.[]"),a=(0,n.default)("topic.id"),o=(0,n.default)("topic.id"),c=(0,n.on)("willDestroyElement"),u={topic:null,presence:(0,s.inject)(),replyChannel:null,whisperChannel:null,replyUsers:function(e){var n=this;return null==e?void 0:e.filter((function(e){return e.id!==n.currentUser.id}))},whisperUsers:function(e){var n=this;return null==e?void 0:e.filter((function(e){return e.id!==n.currentUser.id}))},users:(0,r.union)("replyUsers","whisperUsers"),replyChannelName:function(e){return"/discourse-presence/reply/".concat(e)},whisperChannelName:function(e){return"/discourse-presence/whisper/".concat(e)},shouldDisplay:(0,r.gt)("users.length",0),didReceiveAttrs:function(){var e,n,t,r;(this._super.apply(this,arguments),(null===(e=this.replyChannel)||void 0===e?void 0:e.name)!==this.replyChannelName)&&(null===(t=this.replyChannel)||void 0===t||t.unsubscribe(),this.set("replyChannel",this.presence.getChannel(this.replyChannelName)),this.replyChannel.subscribe());this.currentUser.staff&&(null===(n=this.whisperChannel)||void 0===n?void 0:n.name)!==this.whisperChannelName&&(null===(r=this.whisperChannel)||void 0===r||r.unsubscribe(),this.set("whisperChannel",this.presence.getChannel(this.whisperChannelName)),this.whisperChannel.subscribe())},_destroyed:function(){var e,n;null===(e=this.replyChannel)||void 0===e||e.unsubscribe(),null===(n=this.whisperChannel)||void 0===n||n.unsubscribe()}},p(u,"replyUsers",[i],Object.getOwnPropertyDescriptor(u,"replyUsers"),u),p(u,"whisperUsers",[l],Object.getOwnPropertyDescriptor(u,"whisperUsers"),u),p(u,"replyChannelName",[a],Object.getOwnPropertyDescriptor(u,"replyChannelName"),u),p(u,"whisperChannelName",[o],Object.getOwnPropertyDescriptor(u,"whisperChannelName"),u),p(u,"_destroyed",[c],Object.getOwnPropertyDescriptor(u,"_destroyed"),u),u));e.default=h})),define("discourse/plugins/discourse-presence/discourse/services/composer-presence-manager",["exports","@ember/service","@ember/runloop","discourse-common/config/environment"],(function(e,n,t,r){"use strict";var s,i,l;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,n,t,r){t&&Object.defineProperty(e,n,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(r):void 0})}function c(e,n){if(t=e,!(null!=(r=n)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](t):t instanceof r))throw new TypeError("Cannot call a class as a function");var t,r}function u(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,n){return p=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},p(e,n)}function h(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=m(e);if(n){var s=m(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return d(this,t)}}function d(e,n){return!n||"object"!==a(n)&&"function"!=typeof n?f(e):n}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var y,b,v,C,w,g,_=(l=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&p(e,n)}(d,e);var n,s,l,a=h(d);function d(){var e;c(this,d);for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return o(f(e=a.call.apply(a,[this].concat(t))),"presence",i,f(e)),e}return n=d,(s=[{key:"notifyState",value:function(e,n){if(!this.siteSettings.allow_users_to_hide_profile||!this.currentUser.hide_profile_and_presence){if(void 0===e)return this.leave();if(!["reply","whisper","edit"].includes(e))throw"Unknown intent ".concat(e);var s="".concat(e,"/").concat(n);this._state!==s&&(this._enter(e,n),this._state=s),(0,r.isTesting)()||(this._autoLeaveTimer=(0,t.debounce)(this,this.leave,1e4))}}},{key:"leave",value:function(){var e;null===(e=this._presentChannel)||void 0===e||e.leave(),this._presentChannel=null,this._state=null,this._autoLeaveTimer&&((0,t.cancel)(this._autoLeaveTimer),this._autoLeaveTimer=null)}},{key:"_enter",value:function(e,n){this.leave();var t="".concat("/discourse-presence","/").concat(e,"/").concat(n);this._presentChannel=this.presence.getChannel(t),this._presentChannel.enter()}},{key:"willDestroy",value:function(){this.leave()}}])&&u(n.prototype,s),l&&u(n,l),d}(n.default),y=(s=l).prototype,b="presence",v=[n.inject],C={configurable:!0,enumerable:!0,writable:!0,initializer:null},g={},Object.keys(C).forEach((function(e){g[e]=C[e]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=v.slice().reverse().reduce((function(e,n){return n(y,b,e)||e}),g),w&&void 0!==g.initializer&&(g.value=g.initializer?g.initializer.call(w):void 0,g.initializer=void 0),void 0===g.initializer&&(Object.defineProperty(y,b,g),g=null),i=g,s);e.default=_})),Ember.TEMPLATES["javascripts/components/composer-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[24,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","presence-users"],[8],[0,"\\n    "],[7,"div",true],[10,"class","presence-avatars"],[8],[0,"\\n"],[4,"each",[[24,["presenceUsers"]]],null,{"statements":[[0,"        "],[1,[28,"avatar",[[23,1,[]]],[["imageSize"],["small"]]],false],[0,"\\n"]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","presence-text"],[8],[0,"\\n      "],[7,"span",true],[10,"class","description"],[8],[0,"\\n"],[4,"if",[[24,["isReply"]]],null,{"statements":[[1,[28,"i18n",["presence.replying"],[["count"],[[24,["presenceUsers","length"]]]]],false]],"parameters":[]},{"statements":[[1,[28,"i18n",["presence.editing"],[["count"],[[24,["presenceUsers","length"]]]]],false]],"parameters":[]}],[1,"",false],[9],[1,"",false],[7,"span",true],[10,"class","wave"],[8],[1,"",false],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[1,"",false],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/composer-presence-display"}}),Ember.TEMPLATES["javascripts/components/topic-presence-display"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["user"],"statements":[[4,"if",[[24,["shouldDisplay"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","presence-users"],[8],[0,"\\n    "],[7,"div",true],[10,"class","presence-avatars"],[8],[0,"\\n"],[4,"each",[[24,["users"]]],null,{"statements":[[4,"user-link",null,[["user"],[[23,1,[]]]],{"statements":[[0,"          "],[1,[28,"avatar",[[23,1,[]]],[["imageSize"],["small"]]],false],[0,"\\n"]],"parameters":[]},null]],"parameters":[1]},null],[0,"    "],[9],[0,"\\n    "],[7,"span",true],[10,"class","presence-text"],[8],[0,"\\n      "],[7,"span",true],[10,"class","description"],[8],[1,[28,"i18n",["presence.replying_to_topic"],[["count"],[[24,["users","length"]]]]],false],[9],[7,"span",true],[10,"class","wave"],[8],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[7,"span",true],[10,"class","dot"],[8],[0,"."],[9],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/components/topic-presence-display"}}),Ember.TEMPLATES["javascripts/connectors/before-composer-controls/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"composer-presence-display",null,[["model"],[[24,["model"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/before-composer-controls/presence"}}),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/presence"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"topic-presence-display",null,[["topic"],[[24,["model"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/topic-above-footer-buttons/presence"}});
//# sourceMappingURL=discourse-presence-bc826a395189b32e4676ad0c4414f821f9bab8245747789b6d555fc16581dacd.js.map